buildscript {
    repositories {
        maven { url "http://mocs-artefacts.ensta-bretagne.fr/plug-repo/" }
    }
    dependencies {
        classpath group: 'fr.ensta-bretagne', name: 'plug-plugin', version: '+'
    }
}

apply plugin: 'plug.plugin'


def daily = System.getenv("DAILY")
def computedVersion = daily != null ? "daily" : project.version

subprojects {
    apply plugin: 'application'

    task descriptor(type: Copy, group: 'distribution') {
        def descriptorDir = file("${project.buildDir}/descriptor")
        if (!descriptorDir.exists()) descriptorDir.mkdirs()

        from rootProject.file('template/descriptor.json')
        into descriptorDir
        expand(project: project.name, date: 'today', version: computedVersion)

    }

    distributions {
        main {
            baseName = 'plug-' + project.name
            version = computedVersion
            contents {
                from(project.file("dist")) {
                    "."
                }
            }
        }
    }

    distZip.dependsOn(descriptor)
}

