buildscript {
    repositories {
        jcenter()
        maven { url "https://dl.bintray.com/plug-obp/maven" }
    }
    dependencies {
        classpath group: 'fr.ensta-bretagne', name: 'plug-plugin', version: '0.6'
    }
}

plugins {
    id "com.jfrog.bintray" version "1.8.4"
    //id "edu.sc.seis.macAppBundle" version "2.2.1"
}

apply plugin: 'plug.plugin'


def daily = System.getenv("DAILY")
def computedVersion = daily != null ? "daily-" + new Date().format("yy") : project.version
project.ext.computedVersion =  computedVersion

println "--- Building version:${computedVersion} ---"

subprojects {
    bintray {
        user = project.hasProperty('bintrayUser') ? project.property('bintrayUser') : System.getenv('BINTRAY_USER')
        key = project.hasProperty('bintrayApiKey') ? project.property('bintrayApiKey') : System.getenv('BINTRAY_API_KEY')

        publications = []
        configurations = []
        filesSpec {
            from "${buildDir}/distributions/"
            into '.'
        }

        pkg {
            name = "plug"
            repo = 'distributions'
            userOrg = project.plug.bintrayOrg
            desc = 'Plug distribution'
            vcsUrl = 'https://github.com/plug-obp'
            websiteUrl = 'http://plug-obp.github.io'
            licenses = ['MIT']
            publicDownloadNumbers = true
            override = true
            publish = true

            //Optional version descriptor
            version {
                name = computedVersion //Bintray logical version name
                released  = new Date()
            }
        }
    }
}
